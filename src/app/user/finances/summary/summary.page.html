<app-header title="Personal finances"></app-header>

<ion-content [fullscreen]="true" [scrollEvents]="true">

  <div class="main-content-container">

    <div class="card-container">
      <div class="w-full items-center justify-start flex flex-row gap-2">
        <ion-button size="small" color="medium" shape="round" slot="start" id="filter-popover">
          <ion-icon slot="icon-only" name="filter"></ion-icon>
        </ion-button>
        
        <ion-popover trigger="filter-popover" triggerAction="click" class="select-popover">
          <ng-template>
            <ion-content>
              <div class="flex flex-col items-start justify-start gap-2 py-4 w-full">
                <div class="flex flex-row gap-2 w-full">
                  <div class="flex flex-col gap-2 w-full">
                    
                    <div class="text-neutral-500 text-sm font-bold">
                      Date period
                    </div>
                    <ion-radio-group value="paymentCycle" (ionChange)="datePeriodChanged($event)">
                      <ion-list>
                        @for (filterItem of datePeriodFilterItems; track filterItem.value) {
                          <ion-item lines="none">
                            <ion-radio [value]="filterItem.value">
                              {{filterItem.name}}
                              @if (filterItem.helperTextCallback) {
                                <br /><span class="text-neutral-500">{{filterItem.helperTextCallback()}}</span>
                              }
                            </ion-radio>
                          </ion-item>
                        }
                      </ion-list>
                    </ion-radio-group>
                  </div>

                  <div class="flex flex-col gap-2 w-full">
                    <div class="text-neutral-500 text-sm font-bold">
                      Type
                    </div>

                    <ion-radio-group value="all" (ionChange)="typeChanged($event)">
                      <ion-list>
                        @for (filterItem of typeFilterItems; track filterItem.value) {
                          <ion-item lines="none">
                            <ion-radio [value]="filterItem.value">
                              {{filterItem.name}}
                              @if (filterItem.helperTextCallback) {
                                <br /><span class="text-neutral-500">{{filterItem.helperTextCallback()}}</span>
                              }
                            </ion-radio>
                          </ion-item>
                        }
                      </ion-list>
                    </ion-radio-group>
                  </div>

                </div>
              </div>
            </ion-content>
          </ng-template>
        </ion-popover>

        <ion-chip color="medium" slot="start">
          <ion-label>{{datePeriod().name}}</ion-label>
        </ion-chip>
        <ion-chip color="medium" slot="start">
          <ion-label>{{type().name}}</ion-label>
        </ion-chip>
      </div>

      <div class="h-20 w-full">
        <canvas baseChart [data]="barChartData" type="bar" [options]="barChartOptions"></canvas>
      </div>

      <div class="w-full flex flex-row items-center justify-between gap-2">

        <ion-radio-group (ionChange)="spentTypeChanged($event)">
            <ion-item lines="none" class="w-fit inline-flex">
              <ion-radio [value]="'deliveryFood'">
                <div class="flex flex-row gap-2 items-center">
                  <ion-icon name="ellipse" class="text-neutral-200"></ion-icon>
                  Delivery food <span class="text-neutral-500">— 50%</span>
                </div>
              </ion-radio>
            </ion-item>

            <ion-item lines="none" class="w-fit inline-flex">
              <ion-radio [value]="'services'">
                <div class="flex flex-row gap-2 items-center">
                  <ion-icon name="ellipse" class="text-neutral-300"></ion-icon>
                  Services <span class="text-neutral-500">— 20%</span>
                </div>
              </ion-radio>
            </ion-item>

            <ion-item lines="none" class="w-fit inline-flex">
              <ion-radio [value]="'loans'">
                <div class="flex flex-row gap-2 items-center">
                  <ion-icon name="ellipse" class="text-neutral-400"></ion-icon>
                  Loans <span class="text-neutral-500">— 30%</span>
                </div>
              </ion-radio>
            </ion-item>
        </ion-radio-group>
        
        <!-- <ion-button color="medium" fill="outline" size="small">
          <ion-icon name="ellipse" class="text-neutral-200"></ion-icon>
          Delivery food
        </ion-button>
        <ion-button color="medium" fill="outline" size="small">
          <ion-icon name="ellipse" class="text-neutral-300"></ion-icon>
          Services
        </ion-button>
        <ion-button color="medium" fill="outline" size="small">
          <ion-icon name="ellipse" class="text-neutral-400"></ion-icon>
          Loans
        </ion-button> -->
      </div>

      <div class="card-container">
        <div class="text-lg font-bold">
          Balance
        </div>
        <div class="flex flex-row justify-evenly items-center">
          <div class="flex flex-col items-start justify-center bg-neutral-100">
            <div class="font-bold flex flex-row gap-2 items-center text-green-700">
              <app-number-flow [value]="value" [animated]="true" [format]="currencyNumberFlowFormat"></app-number-flow>          
            </div>
            <div class="text-neutral-500">Earned</div>
          </div>

          <div class="text-xl font-bold text-neutral-500">-</div>

          <div class="flex flex-col items-start justify-center">
            <div class="font-bold flex flex-col` gap-2 items-center text-red-700">
              <app-number-flow [value]="value" [animated]="true" [format]="currencyNumberFlowFormat"></app-number-flow>
            </div>
            <div class="text-neutral-500">Spent</div>
          </div>

          <div class="text-xl font-bold text-neutral-500">=</div>
          
          <div class="flex flex-col items-start justify-center">
            <div class="font-bold flex flex-row gap-2 items-center">
              <app-number-flow [value]="value" [animated]="true" [format]="currencyNumberFlowFormat"></app-number-flow>          
            </div>
            <div class="text-neutral-500">Remaining</div>
          </div>

        </div>
      </div>

      <div class="card-container fade-in-ion-items">
        <div class="text-lg font-bold">Details</div>

        <div>
          <ion-searchbar placeholder="Search" animated="true" searchIcon="search" inputmode="search" enterkeyhint="search" debounce="1000" cancelButtonIcon="close" clearIcon="close" spellcheck="true"></ion-searchbar>

          @if (false) {
            <div class="text-sm text-neutral-500">
              Found 5 results
            </div>
          }
        </div>

        <!-- Detail list -->
        <ion-item lines="none">
          <fa-icon [icon]="faBowlRice" slot="start" class="text-red-700" />
          <div class="flex flex-col" slot="start">
            <ion-label>Chinese Raise</ion-label>
            <div class="flex flex-row gap-2">
              <ion-note>-$10</ion-note>
              <ion-note>Delivery food</ion-note>
            </div>
          </div>
          <ion-label slot="end">15/03/25</ion-label>
        </ion-item>

        <ion-item lines="none">
          <fa-icon [icon]="faBriefcase" slot="start" class="text-green-700" />
          <div class="flex flex-col">
            <ion-label>Work payment</ion-label>
            <div class="flex flex-row gap-2">
              <ion-note>$704</ion-note>
              <ion-note>Payments</ion-note>
            </div>
          </div>
          <ion-label slot="end">20/03/25</ion-label>
        </ion-item>
      </div>
    </div>

  </div>
</ion-content>